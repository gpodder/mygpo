{% extends "base.html" %}
{% load url from future %}
{% load i18n %}

{% load menu %}
{% block mainmenu %}{{ "/account/"|main_menu }}{% endblock %}
{% block sectionmenu %}{{ "/account/"|section_menu }}{% endblock %}

{% block title %}{% trans "Account Settings" %}{% endblock %}

{% block header %}
  <h1>{% trans "Account Settings" %}</h1>
{% endblock %}

{% block content %}

 <div class="tab-content">
  <ul class="nav nav-tabs">
   <li class="active">
    <a href="#account" data-toggle="tab">Account</a>
   </li>
   <li>
    <a href="#profile" data-toggle="tab">Public Profile</a>
   </li>
   <li>
    <a href="#flattr" data-toggle="tab">Flattr</a>
   </li>
  </ul>


  <div class="tab-pane active" id="account">

   <form action="{% url "account" %}" method="POST" class="form-horizontal">
    {% csrf_token %}

    <fieldset>
     <legend>{% trans "Account Data" %}</legend>

     <div class="control-group">
      <label class="control-label" for="input01">{{ form.email.label_tag }}</label>
      <div class="controls">
       {{ form.email }}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="input01">{{ form.password_current.label_tag }}</label>
      <div class="controls">
       {{ form.password_current }}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="input01">{{ form.password1.label_tag }}</label>
      <div class="controls">
       {{ form.password1 }}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="input01">{{ form.password2.label_tag }}</label>
      <div class="controls">
       {{ form.password2 }}
      </div>
     </div>

     <div class="control-group">
      <div class="controls">
       <button class="btn btn-primary" type="submit">{% trans "Save" %}</button>
      </div>
     </div>

   </fieldset>
   </form>

   <h2>{% trans "Delete Account" %}</h2>

   <div class="well">
    <a class="btn btn-danger" href="{% url "delete-account" %}">{% trans "Delete Account" %}</a>
   </div>

  </div>

  <div class="tab-pane" id="profile">

   <form action="{% url "profile" %}" method="POST" class="form-horizontal">
    {% csrf_token %}
    <legend>{% trans "Public profile" %}
     <small>
      <a href="{% url "user" user.username %}{% if userpage_token %}?token={{ userpage_token }}{% endif %}">
       {% trans "for your userpage" %}
      </a>
     </small>
    </legend>

    <fieldset>

     <div class="control-group">
      <label class="control-label" for="twitter">{{ profile_form.twitter.label_tag }}</label>
      <div class="controls">
       <div class="input-prepend">
        <span class="add-on">@</span>
        <input type="text" id="id_twitter" name="twitter" placeholder="username" value="{{ profile_form.twitter.value|default:"" }}">
       </div>
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="about">{{ profile_form.about.label_tag }}
       <span class="help-inline">{{ profile_form.about.help_text }}</span>
      </label>
      <div class="controls">
       {{ profile_form.about }}
      </div>
     </div>

     <div class="control-group">
      <div class="controls">
       <button class="btn btn-primary" type="submit">{% trans "Save" %}</button>
      </div>
     </div>

   </fieldset>
   </form>

  </div>


  <div class="tab-pane" id="flattr">

   <form action="{% url "flattr-settings" %}" method="POST" class="form-horizontal">
    {% csrf_token %}
    <legend>
     {% trans "Flattr" %}
     <small><a href="https://flattr.com/about">{% trans "What's that?" %}</a></small>
    </legend>

    <fieldset>

     <div class="control-group">
      <label class="control-label" for="token">{% trans "Authenticated" %}</label>
      <div class="controls">
       {% if flattr_form.token.value %}
        {% blocktrans with flattr.get_auth_username as flattrname %}Logged in as <a href="https://flattr.com/profile/{{ flattrname }}">{{ flattrname }}</a>{% endblocktrans %}
        <a class="btn" href="{% url "flattr-logout" %}">{% trans "Logout" %}</a>
       {% else %}
        <a class="btn" href="{{ flattr.get_auth_url }}">{% trans "Login" %}</a>
       {% endif %}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="about">{{ flattr_form.enable.label_tag }}
      </label>
      <div class="controls">
       {{ flattr_form.enable }}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="about">{% blocktrans with site as sitename %}Auto-Flattr {{ sitename }}{% endblocktrans %}
      </label>
      <div class="controls">
       {{ flattr_form.flattr_mygpo }}
      </div>
     </div>

     <div class="control-group">
      <label class="control-label" for="username">{% blocktrans with site as sitename %}Username for publishing own content{% endblocktrans %}
      </label>
      <div class="controls">
       {{ flattr_form.username }}
      </div>
     </div>



     <div class="control-group">
      <div class="controls">
       <button class="btn btn-primary" type="submit">{% trans "Save" %}</button>
      </div>
     </div>

   </fieldset>
   </form>

  </div>

 </div>

{% endblock %}


{% block javascript %}

 <script lang="text/javascript">
  $(document).ready(function() {
    var url = document.location.toString();
    if (url.match('#')) {
        $('.nav-tabs a[href=#'+url.split('#')[1]+']').tab('show') ;
    }
  });
 </script>

{% endblock %}
