{% extends "episode-base.html" %}
{% load i18n %}
{% load humanize %}
{% load episodes %}
{% load devices %}
{% load podcasts %}
{% load mygpoutil %}
{% load time %}
{% load youtube %}
{% load flickr %}
{% load charts %}
{% load utils %}
{% load static %}

{% load menu %}
{% block mainmenu %}{{ "/podcast/"|main_menu }}{% endblock %}
{% block sectionmenu %}
 {{ "/podcast/"|section_menu:podcast.display_title }}
{% endblock %}

{% block head %}
 {% if episode.url|is_youtube_video %}
  <script type="text/javascript" src="{% static "js/swfobject.js" %}"></script>
  <script type="text/javascript" src="{% static "js/json2.js" %}"></script>
  <script type="text/javascript" src="{% static "js/youtube-handler.js" %}"></script>
 {% endif %}

{% endblock head %}


{% block content %}

  <hr />

 <div class="btn-toolbar">

  {% if is_publisher %}
   <a class="btn btn-default" href="{% episode_link_target episode podcast "episode-publisher-detail" %}"><i class="icon-wrench"></i> {% trans "Publisher Pages" %}</a>
  {% endif %}

  {% if user.is_authenticated %}
   {% if is_favorite %}
     <a class="btn btn-default" href="{% episode_link_target episode podcast "episode-fav" %}">
      <i class="icon-star"></i> {% trans "Remove Favorite" %}
     </a>
   {% else %}
     <a class="btn btn-default" href="{% episode_link_target episode podcast "episode-fav" %}">
      <i class="icon-star-empty"></i> {% trans "Favorite" %}
     </a>
   {% endif %}
  {% endif %}

   {% if has_history %}
    <a class="btn btn-default" href="{% episode_link_target episode podcast "episode-history" %}">
     <i class="icon-calendar"></i>
     {% trans "Episode History" %}
    </a>
   {% endif %}

  {% if can_flattr %}
   <a class="btn btn-default" href="{% episode_link_target episode podcast "flattr-episode" %}">
    <img src="https://flattr.com/_img/icons/flattr_logo_16.png"
     alt="Flattr {{ episode.title|default:"Unnamed Episode"|striptags }}" />
     {% trans "Flattr" %}
   </a>
  {% endif %}

  {% if user.is_staff %}
   <a class="btn btn-default" href="{% edit_link episode %}">
    <i class="icon-cogs"></i>Admin
   </a>
  {% endif %}


 </div>

 <hr />

  {% if episode.content or episode.description %}
   <div class="description" {% if episode.language or podcast.language %}lang="{% firstof episode.language podcast.language %}"{% endif %}>
    {% if episode.content %}
     {{ episode.content|markdown }}
    {% else %}
     {{ episode.description|markdown }}
    {% endif %}
   </div>
  {% endif %}

  {% if episode.url|is_youtube_video %}
    <div id="ytapiplayer">
      You need Flash player 8+ and JavaScript enabled to view this video.
    </div>
  {% endif %}


  {% if episode.url|is_flickr_photo %}
   {{ episode|embed_flickr_photo }}
  {% endif %}

  {% if episode|is_image %}
   <img src="{{ episode.url }}" />
  {% endif %}

  {% if user.is_authenticated %}

   {% if played_parts %}
    <h3>Already played</h3>
    {{ played_parts|episode_heatmap_visualization }}
   {% endif %}

  {% endif %}

   <ul class="pagination">
    {% if prev %}
     <li>
      {% episode_link prev podcast %}
     </li>
    {% endif %}
    <li>
     <a href="{% podcast_link_target podcast %}#episodes">{% trans "..." %}</a>
    </li>
    {% if next %}
     <li>
      {% episode_link next podcast %}
     </li>
    {% endif %}
   </ul>

{% endblock %}


{% block javascript %}
 <script type="text/javascript">

  {% if episode.url|is_youtube_video %}
   {% embed_youtube_video podcast episode user %}
  {% endif %}

 </script>
{% endblock javascript %}
